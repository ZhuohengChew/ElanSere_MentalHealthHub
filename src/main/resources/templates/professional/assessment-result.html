<!-- Assessment View - Enhanced with Better Formatting -->
<style>
    .assessment-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 20px;
        margin-bottom: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .assessment-header h1 {
        font-weight: 700;
        font-size: 2.5em;
        margin-bottom: 10px;
    }

    .assessment-header p {
        font-size: 1.1em;
        opacity: 0.95;
    }

    .assessment-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #667eea;
        transition: transform 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .stat-card .stat-value {
        font-size: 2em;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
    }

    .stat-card .stat-label {
        font-size: 0.9em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .assessment-content {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
    }

    .assessment-content h3 {
        color: #667eea;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
    }

    .result-badge {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 1.1em;
    }

    .result-badge.excellent {
        background-color: #d4edda;
        color: #155724;
    }

    .result-badge.good {
        background-color: #cce5ff;
        color: #004085;
    }

    .result-badge.fair {
        background-color: #fff3cd;
        color: #856404;
    }

    .result-badge.poor {
        background-color: #f8d7da;
        color: #721c24;
    }

    .details-sidebar {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .detail-item {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #f0f0f0;
    }

    .detail-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .detail-label {
        font-size: 0.85em;
        text-transform: uppercase;
        color: #999;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .detail-value {
        font-size: 1.1em;
        color: #333;
        font-weight: 500;
    }

    .score-bar {
        background-color: #f0f0f0;
        border-radius: 10px;
        height: 24px;
        overflow: hidden;
        margin-top: 10px;
    }

    .score-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.8em;
    }

    .back-button {
        display: inline-block;
        margin-bottom: 20px;
        padding: 8px 16px;
        background: #f8f9fa;
        color: #667eea;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        text-decoration: none;
        transition: all 0.2s;
        font-weight: 500;
    }

    .back-button:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    /* Assessment Content Organization */
    .card-text {
        line-height: 1.8;
    }

    .card-text p {
        margin-bottom: 1rem;
        color: #333;
    }

    .card-text strong {
        color: #667eea;
        font-weight: 600;
    }

    .card-text li {
        margin-bottom: 0.8rem;
    }

    .card-text ol, .card-text ul {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
    }

    /* Question and Score Format */
    .question-item {
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 12px;
        border-radius: 6px;
        border-left: 4px solid #667eea;
        display: block !important;
        clear: both;
    }

    .question-item .question-text {
        color: #333;
        font-weight: 500;
        margin-bottom: 8px;
        display: block;
    }

    .question-item .question-score {
        color: #667eea;
        font-size: 0.9em;
        font-weight: 600;
        display: block;
    }

    .card-text {
        display: block;
        clear: both;
    }

    .card-text br {
        display: block;
        content: "";
        margin: 0.5rem 0;
    }

    /* Ensure questions display in single column */
    .card-text > div {
        clear: both;
        display: block;
        margin-bottom: 12px;
    }

    .assessment-content {
        display: flex;
        flex-direction: column;
    }
</style>

<div class="container-fluid py-5">
    <!-- Back Button -->

    <!-- Header Section -->
    <div class="assessment-header">
        <h1 th:text="${assessment.title}">Assessment Title</h1>
        <p th:text="${assessment.description}">Assessment Description</p>
    </div>

    <!-- Stats Section -->
    <div class="assessment-stats">
        <div class="stat-card">
            <div class="stat-label">Completed Date</div>
            <div class="stat-value" th:text="${#temporals.format(assessment.createdAt, 'dd')}">01</div>
            <div class="stat-label" style="font-size: 0.8em;" th:text="${#temporals.format(assessment.createdAt, 'MMM yyyy')}">Jan 2024</div>
        </div>

        <th:block th:if="${assessment.score != null}">
            <div class="stat-card">
                <div class="stat-label">Score</div>
                <div class="stat-value" th:text="${assessment.score}">32</div>
                <div class="stat-label" style="font-size: 0.8em;">out of 32</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Result</div>
                <div class="stat-value" style="font-size: 1.5em; color: #764ba2;" th:text="${assessment.result}">Good</div>
            </div>
        </th:block>
    </div>

    <!-- Main Content Row -->
    <div class="row">
        <!-- Assessment Content -->
        <div class="col-lg-8">
            <div class="assessment-content">
                <h3>Assessment Details</h3>
                <div class="card-text" th:utext="${assessment.content}">
                    <p>Assessment content will appear here...</p>
                </div>

                <!-- Score Bar -->
                <th:block th:if="${assessment.score != null}">
                    <h5 style="margin-top: 30px; color: #667eea; font-weight: 600;">Performance Overview</h5>
                    <div class="score-bar" style="margin-bottom: 10px;">
                        <div class="score-fill" th:style="'width: ' + ${(assessment.score / 32.0) * 100} + '%'">
                            <span th:text="${#numbers.formatDecimal((assessment.score / 32.0) * 100, 1, 1)} + '%'">100%</span>
                        </div>
                    </div>
                    <small class="text-muted">Your score on this assessment</small>
                </th:block>
            </div>
        </div>

        <!-- Sidebar with Details -->
        <div class="col-lg-4">
            <div class="details-sidebar">
                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 25px;">Assessment Information</h5>

                <!-- Date -->
                <div class="detail-item">
                    <div class="detail-label">
                        <i class="bi bi-calendar-event"></i> Completed Date
                    </div>
                    <div class="detail-value" th:text="${#temporals.format(assessment.createdAt, 'EEEE, dd MMMM yyyy HH:mm')}">
                        Monday, 01 January 2024 10:30
                    </div>
                </div>

                <!-- Score Section -->
                <th:block th:if="${assessment.score != null}">
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="bi bi-percent"></i> Score
                        </div>
                        <div class="detail-value">
                            <span class="h4" style="color: #667eea;" th:text="${assessment.score}">32</span>
                            <span style="color: #999;">/32</span>
                        </div>
                    </div>

                    <!-- Result Badge -->
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="bi bi-award"></i> Result
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="result-badge" 
                                th:classappend="${assessment.result == 'Excellent' ? 'excellent' : assessment.result == 'Good' ? 'good' : assessment.result == 'Fair' ? 'fair' : 'poor'}"
                                th:text="${assessment.result}">
                                Good
                            </span>
                        </div>
                    </div>

                    <!-- Performance Indicator -->
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="bi bi-graph-up"></i> Performance
                        </div>
                        <div style="margin-top: 10px;">
                            <th:block th:if="${assessment.score >= 80}">
                                <span class="badge bg-success">Excellent Performance</span>
                            </th:block>
                            <th:block th:if="${assessment.score >= 60 && assessment.score < 80}">
                                <span class="badge bg-info">Good Performance</span>
                            </th:block>
                            <th:block th:if="${assessment.score >= 40 && assessment.score < 60}">
                                <span class="badge bg-warning">Average Performance</span>
                            </th:block>
                            <th:block th:if="${assessment.score < 40}">
                                <span class="badge bg-danger">Needs Improvement</span>
                            </th:block>
                        </div>
                    </div>
                </th:block>

                <!-- Action Buttons -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                    <a th:href="@{/assessments}" class="btn btn-sm btn-outline-primary w-100 mb-2">
                        <i class="bi bi-list"></i> View All Assessments
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Format assessment content for better readability
    document.addEventListener('DOMContentLoaded', function() {
        const cardText = document.querySelector('.card-text');
        if (cardText && cardText.innerHTML) {
            let content = cardText.innerHTML;
            
            // Replace multiple br tags with a single marker
            content = content.replace(/<br\s*\/?>/gi, '|BR|');
            
            // Split by double breaks to separate questions
            let parts = content.split('|BR||BR|');
            
            let formattedContent = '';
            parts.forEach(part => {
                part = part.replace(/\|BR\|/g, '\n').trim();
                if (part) {
                    // Check if this looks like a question with score
                    const questionMatch = part.match(/^(\d+\.\s+.+?)(\s*(?:Score|score):\s*\d+)/s);
                    if (questionMatch) {
                        formattedContent += '<div class="question-item">' +
                            '<div class="question-text">' + questionMatch[1] + '</div>' +
                            '<div class="question-score"><strong>' + questionMatch[2].trim() + '</strong></div>' +
                            '</div>';
                    } else if (part) {
                        // For content without score pattern, still wrap it
                        formattedContent += '<div class="question-item"><div class="question-text">' + 
                            part.replace(/\n/g, '<br>') + '</div></div>';
                    }
                }
            });
            
            if (formattedContent) {
                cardText.innerHTML = formattedContent;
            }
        }
    });
</script>

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 50%, #fef9c3 100%);
            min-height: 100vh;
        }

        .header-card {
            border-left: 4px solid #6A8EAE;
            background: linear-gradient(135deg, #dbeafe, transparent);
        }

        .detail-card {
            border-left: 4px solid #9B7EDE;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .detail-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #b45309;
        }

        .status-in_progress {
            background-color: #bfdbfe;
            color: #1e40af;
        }

        .status-reviewed {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-scheduled {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-resolved {
            background-color: #c7d2fe;
            color: #3730a3;
        }

        .status-closed {
            background-color: #e5e7eb;
            color: #374151;
        }

        .urgency-badge {
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: 12px;
        }

        .urgency-low {
            background-color: #d1fae5;
            color: #065f46;
        }

        .urgency-medium {
            background-color: #fef3c7;
            color: #b45309;
        }

        .urgency-high {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .urgency-critical {
            background-color: #fecaca;
            color: #7f1d1d;
        }

        .info-label {
            font-weight: 600;
            color: #6b7280;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .info-value {
            color: #1f2937;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .action-section {
            background: linear-gradient(135deg, #faf5ff, transparent);
            border: 2px solid #e9d5ff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
        }

        .btn-gradient-blue {
            background: linear-gradient(135deg, #6A8EAE, #5A7E9E);
            color: white;
            border: none;
        }

        .btn-gradient-blue:hover {
            opacity: 0.9;
            color: white;
        }

        .progress-bar-custom {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9B7EDE, #7FB685);
            transition: width 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #6A8EAE, #5A7E9E);
            color: white;
        }

        .btn-close-white {
            filter: brightness(0) invert(1);
        }

        .resolution-box {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .resolution-box h6 {
            color: #065f46;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .resolution-box p {
            color: #047857;
            margin: 0;
            font-size: 0.95rem;
        }

        .report-type-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 10px;
            white-space: nowrap;
        }

        .type-mental-health {
            background: linear-gradient(135deg, #e0e7ff, #f3e8ff);
            color: #5b21b6;
            border-left: 4px solid #7c3aed;
        }

        .type-academic {
            background: linear-gradient(135deg, #dbeafe, #e0e7ff);
            color: #1e40af;
            border-left: 4px solid #2563eb;
        }

        .type-physical {
            background: linear-gradient(135deg, #dcfce7, #e0e7ff);
            color: #15803d;
            border-left: 4px solid #22c55e;
        }

        .type-social {
            background: linear-gradient(135deg, #fce7f3, #dbeafe);
            color: #831843;
            border-left: 4px solid #ec4899;
        }

        .type-financial {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            color: #b45309;
            border-left: 4px solid #f59e0b;
        }

        .type-housing {
            background: linear-gradient(135deg, #fed7aa, #fecaca);
            color: #9a3412;
            border-left: 4px solid #f97316;
        }

        .type-other {
            background: linear-gradient(135deg, #e5e7eb, #f3f4f6);
            color: #374151;
            border-left: 4px solid #6b7280;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-lg-10 offset-lg-1">
                <div class="card header-card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h1 class="d-flex align-items-center gap-2 mb-2">
                                    <i class="bi bi-file-text" style="color: #6A8EAE;"></i>
                                    Report Details
                                </h1>
                                <p class="text-muted mb-0">View complete information about your submitted concern</p>
                            </div>
                            <button class="btn btn-secondary" onclick="window.history.back()">
                                <i class="bi bi-arrow-left me-2"></i>Back
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Details -->
        <div class="row">
            <div class="col-lg-10 offset-lg-1">
                <!-- Main Report Card -->
                <div class="card detail-card shadow">
                    <div class="card-header bg-white border-bottom">
                        <!-- Report Type Badge -->
                        <div class="mb-3">
                            <span class="report-type-badge" th:classappend="${report.type.contains('Mental') ? 'type-mental-health' : report.type.contains('Academic') ? 'type-academic' : report.type.contains('Physical') ? 'type-physical' : report.type.contains('Social') ? 'type-social' : report.type.contains('Financial') ? 'type-financial' : report.type.contains('Housing') ? 'type-housing' : 'type-other'}">
                                <i class="bi me-2" th:classappend="${report.type.contains('Mental') ? 'bi-heart-pulse' : report.type.contains('Academic') ? 'bi-book' : report.type.contains('Physical') ? 'bi-activity' : report.type.contains('Social') ? 'bi-people' : report.type.contains('Financial') ? 'bi-currency-dollar' : report.type.contains('Housing') ? 'bi-house' : 'bi-question-circle'}"></i>
                                <span th:text="${report.type} ?: 'General Concern'">Report Type</span>
                            </span>
                        </div>

                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="status-badge" th:classappend="${'status-' + report.status}">
                                        <i class="bi" th:classappend="${report.status == 'resolved' ? 'bi-check-circle-fill' : report.status == 'pending' ? 'bi-clock' : report.status == 'reviewed' ? 'bi-eye' : report.status == 'scheduled' ? 'bi-calendar' : 'bi-info-circle'}"></i>
                                        <span th:text="${#strings.capitalize(report.status)}">Status</span>
                                    </span>
                                    <span class="urgency-badge" th:classappend="${'urgency-' + #strings.toLowerCase(report.urgency)}" th:if="${report.urgency}">
                                        <span th:text="${#strings.capitalize(report.urgency)}">Urgency</span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <small class="text-muted d-block">
                                    <i class="bi bi-calendar3 me-2"></i>
                                    <span th:text="${#temporals.format(report.submittedAt, 'MMM dd, yyyy HH:mm')}">Date</span>
                                </small>
                                <small class="text-muted d-block mt-2" th:if="${report.updatedAt != report.submittedAt}">
                                    <i class="bi bi-arrow-repeat me-2"></i>
                                    <span>Updated: <span th:text="${#temporals.format(report.updatedAt, 'MMM dd, yyyy')}">Date</span></span>
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Description Section -->
                        <div class="mb-4">
                            <div class="info-label">
                                <i class="bi bi-chat-left-text me-2"></i>Description
                            </div>
                            <div class="info-value">
                                <p th:text="${report.description}" class="mb-0 text-justify">No description provided</p>
                            </div>
                        </div>

                        <!-- Resolution Notes (if resolved/closed) -->
                        <div th:if="${report.status == 'resolved' || report.status == 'closed'}" class="mb-4">
                            <div class="info-label">
                                <i class="bi bi-check-circle me-2"></i>Resolution Details
                            </div>
                            <div class="resolution-box" th:if="${report.resolutionNotes}">
                                <h6>Resolution Notes</h6>
                                <p th:text="${report.resolutionNotes}">No notes provided</p>
                            </div>
                            <small class="text-muted d-block mt-2" th:if="${report.resolvedAt}">
                                <i class="bi bi-check-lg me-2"></i>
                                <span>Resolved on: <strong th:text="${#temporals.format(report.resolvedAt, 'MMM dd, yyyy HH:mm')}">Date</strong></span>
                            </small>
                        </div>

                        <!-- Report Information Box -->
                        <div class="alert alert-info d-flex align-items-start" role="alert">
                            <i class="bi bi-info-circle me-3 flex-shrink-0" style="margin-top: 3px;"></i>
                            <div>
                                <strong>Report Information</strong>
                                <p class="mb-0 mt-2 small">
                                    This report was submitted on <strong th:text="${#temporals.format(report.submittedAt, 'MMM dd, yyyy')}">date</strong>.
                                    <span th:if="${report.status == 'pending'}">A mental health professional will review your concern soon.</span>
                                    <span th:if="${report.status == 'reviewed'}">Your report has been reviewed and next steps will be communicated to you.</span>
                                    <span th:if="${report.status == 'scheduled'}">An appointment has been scheduled for you. Check your email for details.</span>
                                    <span th:if="${report.status == 'resolved'}">Your report has been resolved. Please feel free to submit a new report if needed.</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="mt-4 mb-4">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-secondary" onclick="window.history.back()">
                            <i class="bi bi-arrow-left me-2"></i>Back to List
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Update Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statusModalLabel">
                        <i class="bi bi-tag me-2"></i>Update Report Status
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Select New Status:</label>
                        <select class="form-select" id="statusSelect">
                            <option value="">-- Select Status --</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="reviewed">Reviewed</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-gradient-blue" onclick="updateStatus()">Update Status</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resolve Modal -->
    <div class="modal fade" id="resolveModal" tabindex="-1" aria-labelledby="resolveModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resolveModalLabel">
                        <i class="bi bi-check-circle me-2"></i>Mark as Resolved
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Resolution Notes:</label>
                        <textarea class="form-control" id="resolutionNotes" rows="4" placeholder="Provide details about how this concern was resolved..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="resolveReport()">
                        <i class="bi bi-check-lg me-2"></i>Mark as Resolved
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        const reportId = /*[[${report.id}]]*/ 0;
        const canEdit = /*[[${canEdit}]]*/ false;

        function showStatusModal() {
            const modal = new bootstrap.Modal(document.getElementById('statusModal'));
            modal.show();
        }

        function showResolveModal() {
            const modal = new bootstrap.Modal(document.getElementById('resolveModal'));
            modal.show();
        }

        function updateStatus() {
            const status = document.getElementById('statusSelect').value;
            if (!status) {
                alert('Please select a status');
                return;
            }

            fetch(`/concerns/api/${reportId}/status?status=${status}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Status updated successfully');
                    location.reload();
                } else {
                    alert('Failed to update status');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating status');
            });
        }

        function resolveReport() {
            const notes = document.getElementById('resolutionNotes').value;
            if (!notes.trim()) {
                alert('Please provide resolution notes');
                return;
            }

            fetch(`/concerns/api/${reportId}/resolve?resolutionNotes=${encodeURIComponent(notes)}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Report marked as resolved successfully');
                    location.reload();
                } else {
                    alert('Failed to resolve report');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error resolving report');
            });
        }
    </script>
</body>
</html>


